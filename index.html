<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dự Đoán Tài Xỉu</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #e0eafc, #cfdef3);
    }

    #app {
      max-width: 500px;
      margin: 0 auto;
      background: #fff;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      display: none;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 20px;
    }

    #history {
      width: 100%;
      padding: 14px;
      font-size: 18px;
      margin-bottom: 16px;
      border: 2px solid #3498db;
      border-radius: 10px;
      outline: none;
    }

    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-bottom: 20px;
    }

    button {
      flex: 1 1 40%;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .btn-add {
      background: #3498db;
      color: white;
    }

    .btn-add:hover {
      background: #2980b9;
    }

    .btn-predict {
      background: #2ecc71;
      color: white;
    }

    .btn-predict:hover {
      background: #27ae60;
    }

    .btn-reset {
      background: #e74c3c;
      color: white;
    }

    .btn-reset:hover {
      background: #c0392b;
    }

    #prediction {
      text-align: center;
      font-size: 22px;
      font-weight: bold;
      color: #8e44ad;
      margin-top: 10px;
    }

    @media (max-width: 480px) {
      .button-group {
        flex-direction: column;
      }

      button {
        flex: 1 1 100%;
      }
    }
  </style>
</head>
<body onload="checkKey()">
  <div id="app">
    <h1>Dự Đoán Tài Xỉu</h1>
    <input type="text" id="history" placeholder="Nhập chuỗi kết quả (T/X)">
    <div class="button-group">
      <button class="btn-add" onclick="addResult('T')">Tài</button>
      <button class="btn-add" onclick="addResult('X')">Xỉu</button>
      <button class="btn-predict" onclick="predict()">Dự Đoán</button>
      <button class="btn-reset" onclick="resetForm()">Xóa</button>
    </div>
    <div id="prediction">...</div>
  </div>

  <!-- Script phần backend giữ nguyên như cũ -->
  <script>
    async function checkKey() {
    let enteredKey = prompt("Nhập key truy cập:");
    if (!enteredKey) {
      denyAccess();
      return;
    }

    try {
      const response = await fetch("https://raw.githubusercontent.com/<user>/<repo>/main/keys.json"); // <-- Link thật ở đây
      const data = await response.json();
      const keys = data.keys;

      if (keys.includes(enteredKey)) {
        document.getElementById("app").style.display = "block";
      } else {
        denyAccess();
      }
    } catch (error) {
      alert("Không thể kiểm tra key.");
      denyAccess();
    }
  }

  function denyAccess() {
    document.body.innerHTML = "<h2 style='color:red;text-align:center;'>Bạn không có quyền truy cập</h2>";
  }

    function addResult(value) {
      const input = document.getElementById("history");
      input.value += value;
    }

    function resetForm() {
      document.getElementById("history").value = "";
      document.getElementById("prediction").innerText = "...";
    }

    function predict() {
      const history = document.getElementById("history").value.trim().toUpperCase();
      if (history.length < 3) {
        document.getElementById("prediction").innerText = "Không đủ dữ liệu";
        return;
      }

      const fixedPatterns = {
        "TTX": "Xỉu", "XXT": "Tài", "TXT": "Xỉu", "XTX": "Tài", "TXX": "Tài",
        // (đoạn patterns giữ nguyên)
        "TTTXX": "Xỉu"
      };

      for (let len = 6; len >= 3; len--) {
        const recent = history.slice(-len);
        if (fixedPatterns[recent]) {
          document.getElementById("prediction").innerText = `Dự đoán (pattern '${recent}'): ${fixedPatterns[recent]}`;
          return;
        }
      }

      const maxPatternLength = 5;
      const frequencyMap = {};
      for (let len = 2; len <= maxPatternLength; len++) {
        for (let i = 0; i <= history.length - len - 1; i++) {
          const pattern = history.slice(i, i + len);
          const nextChar = history[i + len];
          if (!frequencyMap[pattern]) frequencyMap[pattern] = { T: 0, X: 0 };
          if (nextChar === 'T' || nextChar === 'X') frequencyMap[pattern][nextChar]++;
        }
      }

      for (let len = maxPatternLength; len >= 2; len--) {
        const recentPattern = history.slice(-len);
        const freq = frequencyMap[recentPattern];
        if (freq) {
          const prediction = freq.T > freq.X ? "Tài" : freq.X > freq.T ? "Xỉu" : "Ngẫu nhiên";
          document.getElementById("prediction").innerText =
            `Dự đoán (học '${recentPattern}'): ${prediction}`;
          return;
        }
      }

      const last10 = history.slice(-10);
      const countT = (last10.match(/T/g) || []).length;
      const countX = (last10.match(/X/g) || []).length;
      let fallback = "Ngẫu nhiên";
      if (countT > countX) fallback = "Xỉu";
      else if (countX > countT) fallback = "Tài";
      document.getElementById("prediction").innerText = "Dự đoán (thống kê): " + fallback;
    }
  </script>
</body>
</html>